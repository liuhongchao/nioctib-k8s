apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: bitcoind
  name: bitcoind
spec:
  replicas: 1
  selector:
    matchLabels:
      app: bitcoind
  template:
    metadata:
      labels:
        app: bitcoind
      name: bitcoind
    spec:
      containers:
      - args:
        env:
        - name: BITCOIN_EXTRA_ARGS
          # password: 7Rq@s4%7WmDS
          # rpcauth generated using: ./rpcauth.py h0ngchao 7Rq@s4%7WmDS
          value: "rpcauth=h0ngcha0:65983086d4a91fbd309be6d5ed260348$8285069f409b6962315cab117661bf8e330f3c885465cb07ad2a826a182a554b\ntxindex=1"
        image: nicolasdorier/docker-bitcoin:0.18.1
        imagePullPolicy: Always
        name: bitcoind
#        resources:
#          limits:
#            cpu: "1"
#            memory: 3G
#          requests:
#            memory: 1500M
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /data
          name: bitcoin-blockchain-data
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext:
        runAsUser: 0
      terminationGracePeriodSeconds: 30
      volumes:
      - name: bitcoin-blockchain-data
        persistentVolumeClaim:
          claimName: bitcoin-blockchain-pvc-claim
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  finalizers:
  - kubernetes.io/pvc-protection
  name: bitcoin-blockchain-pvc-claim
spec:
  accessModes:
  - ReadWriteOnce
  dataSource: null
  resources:
    requests:
      storage: 350Gi
  storageClassName: standard
  volumeMode: Filesystem